<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magyar Politikai TikTok Tartalom Generátor</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Segoe UI',-apple-system,BlinkMacSystemFont,sans-serif; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); min-height:100vh; color:#333; }
        .header{ background:rgba(255,255,255,.95); backdrop-filter:blur(10px); padding:1rem 0; box-shadow:0 2px 20px rgba(0,0,0,.1); }
        .header-content{ max-width:1200px; margin:0 auto; padding:0 2rem; display:flex; align-items:center; justify-content:space-between; }
        .logo{ display:flex; align-items:center; gap:1rem; }
        .logo i{ font-size:2rem; color:#667eea; }
        .logo h1{ font-size:1.5rem; font-weight:700; color:#2d3748; }
        .lang-toggle{ display:flex; gap:.5rem; }
        .lang-btn{ padding:.5rem 1rem; border:1px solid #e2e8f0; background:#fff; border-radius:6px; cursor:pointer; transition:.2s; }
        .lang-btn.active{ background:#667eea; color:#fff; border-color:#667eea; }
        .container{ max-width:800px; margin:2rem auto; padding:0 2rem; }
        .form-card{ background:#fff; border-radius:16px; padding:3rem; box-shadow:0 10px 40px rgba(0,0,0,.1); margin-bottom:2rem; }
        .form-title{ font-size:2rem; font-weight:700; color:#2d3748; margin-bottom:.5rem; text-align:center; }
        .form-subtitle{ color:#718096; text-align:center; margin-bottom:2rem; font-size:1.1rem; }
        .form-group{ margin-bottom:1.5rem; }
        .form-group label{ display:block; font-weight:600; color:#4a5568; margin-bottom:.5rem; }
        .form-control{ width:100%; padding:.875rem 1rem; border:2px solid #e2e8f0; border-radius:8px; font-size:1rem; transition:.2s; background:#fff; }
        .form-control:focus{ outline:none; border-color:#667eea; box-shadow:0 0 0 3px rgba(102,126,234,.1); }
        .form-control:invalid{ border-color:#e53e3e; }
        .form-row{ display:grid; grid-template-columns:1fr 1fr; gap:1rem; }
        .topics-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:.5rem; margin-top:.5rem; }
        .topic-checkbox{ display:flex; align-items:center; gap:.5rem; padding:.5rem; background:#f7fafc; border-radius:6px; cursor:pointer; transition:.2s; }
        .topic-checkbox:hover{ background:#edf2f7; }
        .topic-checkbox.selected{ background:#667eea; color:#fff; }
        .topic-checkbox input{ display:none; }
        .generate-btn{ width:100%; padding:1rem 2rem; background:linear-gradient(135deg,#667eea,#764ba2); color:#fff; border:none; border-radius:12px; font-size:1.1rem; font-weight:600; cursor:pointer; transition:.3s; margin-top:1rem; }
        .generate-btn:hover:not(:disabled){ transform:translateY(-2px); box-shadow:0 10px 30px rgba(102,126,234,.3); }
        .generate-btn:disabled{ opacity:.6; cursor:not-allowed; }
        .status-card{ background:#fff; border-radius:12px; padding:2rem; box-shadow:0 5px 20px rgba(0,0,0,.1); margin-top:2rem; text-align:center; display:none; }
        .status-card.show{ display:block; }
        .loading{ display:flex; align-items:center; justify-content:center; gap:1rem; color:#667eea; }
        .spinner{ width:40px; height:40px; border:4px solid #e2e8f0; border-top:4px solid #667eea; border-radius:50%; animation:spin 1s linear infinite; }
        @keyframes spin{ 0%{transform:rotate(0)} 100%{transform:rotate(360deg)} }
        .success{ color:#38a169; }
        .error{ color:#e53e3e; }
        .result-info{ background:#f0fff4; border:1px solid #9ae6b4; border-radius:8px; padding:1rem; margin-top:1rem; text-align:left; }
        .features{ display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:1.5rem; margin-top:3rem; }
        .feature-card{ background:rgba(255,255,255,.95); backdrop-filter:blur(10px); padding:2rem; border-radius:12px; text-align:center; box-shadow:0 5px 20px rgba(0,0,0,.1); }
        .feature-card i{ font-size:3rem; color:#667eea; margin-bottom:1rem; }
        .feature-card h3{ font-size:1.2rem; font-weight:600; margin-bottom:1rem; color:#2d3748; }
        .feature-card p{ color:#718096; line-height:1.6; }
        @media (max-width:768px){ .form-row{ grid-template-columns:1fr; } .form-card{ padding:2rem 1.5rem; } .container{ padding:0 1rem; } }
        .hidden{ display:none !important; }
        .help{ font-size:.85rem; color:#718096; margin-top:.35rem; }
    </style>
</head>
<body>
<header class="header">
    <div class="header-content">
        <div class="logo">
            <i class="fab fa-tiktok"></i>
            <h1 data-hu="Magyar Politikai TikTok Generátor" data-en="Hungarian Political TikTok Generator">Magyar Politikai TikTok Generátor</h1>
        </div>
        <div class="lang-toggle">
            <button class="lang-btn active" onclick="setLanguage('hu', event)">HU</button>
            <button class="lang-btn" onclick="setLanguage('en', event)">EN</button>
        </div>
    </div>
</header>

<div class="container">
    <div class="form-card">
        <h2 class="form-title" data-hu="Tartalom Ötletek Generálása" data-en="Generate Content Ideas">Tartalom Ötletek Generálása</h2>
        <p class="form-subtitle" data-hu="AI-alapú TikTok tartalom ötletek magyar politikai kontextusban" data-en="AI-powered TikTok content ideas in Hungarian political context">AI-alapú TikTok tartalom ötletek magyar politikai kontextusban</p>

        <form id="contentForm">
            <div class="form-row">
                <div class="form-group">
                    <label data-hu="Szervezet típusa *" data-en="Organization Type *">Szervezet típusa *</label>
                    <select class="form-control" id="organizationType" name="organization_type" required>
                        <option value="ministry" data-hu="Minisztérium" data-en="Ministry">Minisztérium</option>
                        <option value="party" data-hu="Politikai párt" data-en="Political Party">Politikai párt</option>
                        <option value="journalist" data-hu="Újságíró/Média" data-en="Journalist/Media">Újságíró/Média</option>
                        <option value="ngo" data-hu="Civil szervezet" data-en="NGO">Civil szervezet</option>
                        <option value="agency" data-hu="PR Ügynökség" data-en="PR Agency">PR Ügynökség</option>
                    </select>
                </div>
                <div class="form-group">
                    <label data-hu="Régió *" data-en="Region *">Régió *</label>
                    <select class="form-control" id="region" name="region" required>
                        <option value="budapest" data-hu="Budapest" data-en="Budapest">Budapest</option>
                        <option value="videk" data-hu="Vidék" data-en="Rural Areas">Vidék</option>
                        <option value="nagyvarosok" data-hu="Nagyvárosok" data-en="Major Cities">Nagyvárosok</option>
                        <option value="national" data-hu="Országos" data-en="National">Országos</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label data-hu="Email cím (PDF jelentéshez) *" data-en="Email Address (for PDF report) *">Email cím (PDF jelentéshez) *</label>
                <input type="email" class="form-control" id="email" name="email" required placeholder="valaki@example.com">
            </div>

            <div class="form-group">
                <label data-hu="Kulcsszó/Téma *" data-en="Keyword/Topic *">Kulcsszó/Téma *</label>
                <input type="text" class="form-control" id="keyword" name="keyword" required placeholder="pl. egészségügyi reform, oktatás, gazdaságpolitika">
            </div>

            <!-- NEW: TikTok username (optional) -->
            <div class="form-group">
                <label data-hu="TikTok felhasználónév (opcionális)" data-en="TikTok username (optional)">TikTok felhasználónév (opcionális)</label>
                <input
                  type="text"
                  class="form-control"
                  id="tiktokUsername"
                  name="tiktok_username"
                  placeholder="@felhasznalonev"
                  inputmode="text"
                  maxlength="24"
                  pattern="^@?[A-Za-z0-9._]{2,24}$"
                  title="Csak betűk, számok, pont és aláhúzás; 2–24 karakter.">
                <div class="help" data-hu="Csak betűk, számok, pont és aláhúzás (2–24 karakter). Példa: @magyarpolitika" data-en="Letters, numbers, dot and underscore (2–24 chars). Example: @hungarianpolitics">Csak betűk, számok, pont és aláhúzás (2–24 karakter). Példa: @magyarpolitika</div>
            </div>
            <!-- /NEW -->

            <div class="form-group">
                <label data-hu="Természetes nyelvű kérés (opcionális)" data-en="Natural Language Request (optional)">Természetes nyelvű kérés (opcionális)</label>
                <textarea class="form-control" id="prompt" name="prompt" rows="3" placeholder="pl. Hogyan kommunikáljuk az új egészségügyi reformot a fiataloknak TikTokon?"></textarea>
            </div>

            <div class="form-group">
                <label data-hu="Releváns hashtag témák (válassz legalább 2-t)" data-en="Relevant Hashtag Topics (select at least 2)">Releváns hashtag témák (válassz legalább 2-t)</label>
                <div class="topics-grid" id="topicsGrid"></div>
            </div>

            <button type="submit" class="generate-btn" id="generateBtn">
                <i class="fas fa-magic"></i>
                <span data-hu="Ötletek Generálása" data-en="Generate Ideas">Ötletek Generálása</span>
            </button>
        </form>
    </div>

    <div class="status-card" id="statusCard">
        <div id="loadingStatus" class="loading">
            <div class="spinner"></div>
            <div>
                <h3 data-hu="Tartalom generálás folyamatban..." data-en="Generating content...">Tartalom generálás folyamatban...</h3>
                <p data-hu="Ez 30-60 másodpercig is eltarthat..." data-en="This may take 30-60 seconds...">Ez 30-60 másodpercig is eltarthat...</p>
            </div>
        </div>
        <div id="successStatus" class="success hidden">
            <i class="fas fa-check-circle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
            <h3 data-hu="Sikeres generálás!" data-en="Generation Successful!">Sikeres generálás!</h3>
            <p data-hu="A jelentés elküldve az email címére." data-en="Report sent to your email address.">A jelentés elküldve az email címére.</p>
            <div class="result-info" id="resultInfo"></div>
        </div>
        <div id="duplicateStatus" class="hidden" style="color: #f56500;">
            <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
            <h3 data-hu="Duplikált tartalom észlelve" data-en="Duplicate Content Detected">Duplikált tartalom észlelve</h3>
            <p data-hu="Hasonló tartalom már létrejött az elmúlt héten. Próbálj más kulcsszavakat!" data-en="Similar content was already generated this week. Try different keywords!">Hasonló tartalom már létrejött az elmúlt héten. Próbálj más kulcsszavakat!</p>
        </div>
        <div id="errorStatus" class="error hidden">
            <i class="fas fa-times-circle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
            <h3 data-hu="Hiba történt" data-en="An Error Occurred">Hiba történt</h3>
            <p id="errorMessage"></p>
        </div>
    </div>

    <div class="features">
        <div class="feature-card">
            <i class="fas fa-brain"></i>
            <h3 data-hu="Memória Védelem" data-en="Memory Protection">Memória Védelem</h3>
            <p data-hu="Automatikusan kerüli a duplikált ötleteket és korábbi tartalmakat" data-en="Automatically avoids duplicate ideas and previous content">Automatikusan kerüli a duplikált ötleteket és korábbi tartalmakat</p>
        </div>
        <div class="feature-card">
            <i class="fas fa-chart-trending-up"></i>
            <h3 data-hu="Trending Analízis" data-en="Trending Analysis">Trending Analízis</h3>
            <p data-hu="Valós idejű magyar politikai trend elemzés és releváns ötletek" data-en="Real-time Hungarian political trend analysis and relevant ideas">Valós idejű magyar politikai trend elemzés és releváns ötletek</p>
        </div>
        <div class="feature-card">
            <i class="fas fa-map-marked-alt"></i>
            <h3 data-hu="Lokális Kontextus" data-en="Local Context">Lokális Kontextus</h3>
            <p data-hu="Magyar politikai specifikus tartalom regionális relevancia szerint" data-en="Hungarian political specific content by regional relevance">Magyar politikai specifikus tartalom regionális relevancia szerint</p>
        </div>
    </div>
</div>

<script>
    // Configuration - UPDATE THIS WITH YOUR N8N WEBHOOK URL
    const WEBHOOK_URL = 'https://padavan1129.app.n8n.cloud/webhook/generate-hungarian-content';

    // Hungarian political topics
    const hungarianTopics = {
        'hu': ['#egészségügy','#oktatás','#gazdaság','#infláció','#nyugdíj','#kórházak','#tanárok','#eu','#brüsszel','#beruházás','#fejlesztés','#munkahelyek','#család','#szuverenitás','#energiaárak','#lakhatás','#közlekedés','#digitalizáció','#klímaváltozás','#migráció'],
        'en': ['#healthcare','#education','#economy','#inflation','#pension','#hospitals','#teachers','#eu','#brussels','#investment','#development','#jobs','#family','#sovereignty','#energy','#housing','#transport','#digitalization','#climate','#migration']
    };

    let currentLanguage = 'hu';
    let selectedTopics = [];

    document.addEventListener('DOMContentLoaded', function() {
        generateUserId();
        populateTopics();
        setupForm();

        // sanitize username as user types (allow letters/numbers/._ and leading @)
        const u = document.getElementById('tiktokUsername');
        u.addEventListener('input', e => {
            e.target.value = e.target.value.replace(/[^A-Za-z0-9._@]/g,'');
        });
    });

    function generateUserId() {
        if (!localStorage.getItem('hungarian_political_user_id')) {
            const userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            localStorage.setItem('hungarian_political_user_id', userId);
        }
    }

    function populateTopics() {
        const topicsGrid = document.getElementById('topicsGrid');
        const topics = hungarianTopics[currentLanguage];
        topicsGrid.innerHTML = topics.map(topic => `
            <div class="topic-checkbox" onclick="toggleTopic('${topic}')">
                <input type="checkbox" id="topic_${topic}" name="topics" value="${topic}">
                <span>${topic}</span>
            </div>
        `).join('');
    }

    function toggleTopic(topic) {
        const checkbox = document.getElementById(`topic_${topic}`);
        const container = checkbox.parentElement;
        if (selectedTopics.includes(topic)) {
            selectedTopics = selectedTopics.filter(t => t !== topic);
            container.classList.remove('selected');
            checkbox.checked = false;
        } else {
            selectedTopics.push(topic);
            container.classList.add('selected');
            checkbox.checked = true;
        }
    }

    function setupForm() {
        const form = document.getElementById('contentForm');
        form.addEventListener('submit', handleFormSubmit);
    }

    function cleanUsername(raw) {
        if (!raw) return null;
        const x = raw.trim().replace(/^@/, '').toLowerCase();
        return x.length ? x : null;
    }

    async function handleFormSubmit(e) {
        e.preventDefault();

        if (selectedTopics.length < 2) {
            alert(currentLanguage === 'hu' ? 'Legalább 2 hashtag témát válassz ki!' : 'Please select at least 2 hashtag topics!');
            return;
        }

        const formData = new FormData(e.target);
        const userId = localStorage.getItem('hungarian_political_user_id');

        const requestData = {
            user_id: userId,
            keyword: formData.get('keyword'),
            email: formData.get('email'),
            organization_type: formData.get('organization_type'),
            region: formData.get('region'),
            prompt: formData.get('prompt'),
            topics: selectedTopics,
            // NEW: optional TikTok username
            tiktok_username: cleanUsername(formData.get('tiktok_username') || '')
        };

        console.log('Sending request:', requestData);

        showStatus('loading');

       
